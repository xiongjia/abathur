# -*- mode: org; mode: auto-fill -*-
#+TITLE: Windows Batch
#+AUTHOR: xiong-jia.le
#+EMAIL: lexiongjia@gmail.com
#+OPTIONS: title:nil num:nil *:nil ^:nil
#+HTML_INCLUDE_STYLE: nil
#+HTML_DOCTYPE: <!doctype html>
#+HTML_HEAD: <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
#+HTML_HEAD: <meta http-equiv="cache-control" content="max-age=0" />
#+HTML_HEAD: <meta http-equiv="cache-control" content="no-cache" />
#+HTML_HEAD: <meta http-equiv="expires" content="0" />
#+HTML_HEAD: <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
#+HTML_HEAD: <meta http-equiv="pragma" content="no-cache" />
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="/assets/css/main_v0.1.css" /> 

记录一些工作，生活中用到的 Windows Batch 的"套路"。
俺自己日常用的 Windows 脚本一部分是 bat 一部分是 PowerShell 主要都可以在我的
Github 的这个仓库找到: [[https://github.com/xiongjia/dotfiles/tree/master/win][DotFiles - Windows scripts]]

* Patterns 
** Path
*** bat file pat
当前 bat 脚本文件所在的路径
#+BEGIN_SRC bat
@echo off
setlocal
set _current_dir=%~dp0.\
echo Current dir: %_current_dir%
endlocal
#+END_SRC

*** make a temp file/folder
使用时间戳生成临时文件/目录名。完成操作后删除改文件。
#+BEGIN_SRC bat
@echo off
setlocal
set _tmp_dir=%temp%
set _time_str=%time::=.%
set _time_str=%_time_str: =_%
set _date_str=%date:/=-%
set _date_str=%_date_str: =_%
:: The Temp filename = <tmp dir>\prefix_<time-stamp>.tmp
set _tmp_file=%_tmp_dir%\_tmp_file_prefix_%_date_str%_%_time_str%.tmp
echo Temp filename: "%_tmp_file%"
echo Test data > "%_tmp_file%"
:: remove this temp file
del /F /Q %_tmp_file%
endlocal
#+END_SRC

** Strings
*** string replacement
替换 time 中的冒号和空格。
#+BEGIN_SRC bat
@echo off
setlocal
echo Before replacement %time%
:: ':' -> '.' (colon to dot)
set _time_str=%time::=.%
:: ' ' -> '_' (space to underline)
set _time_str=%_time_str: =_%
echo After replacement %_time_str%
endlocal
#+END_SRC

